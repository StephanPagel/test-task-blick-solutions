{{ 'section-main-product-blicksolutions.css' | asset_url | stylesheet_tag }}

<section class="product-blicksolutions">
  <div class="product-content-wrapper">
    <div class="product-gallery-wrapper">
      <!-- Thumbnail Carousel -->
      <div class="thumbnail-carousel-wrapper">
        <div id="thumbnail-carousel" class="splide" aria-label="Thumbnail Carousel">
          <div class="splide__track">
            <ul class="splide__list">
              {% for image in product.images %}
                <li class="splide__slide">
                  {{ image | image_url: width: 100 | image_tag: alt: 'product image' }}
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      <!-- Main Carousel -->
      <div class="main-carousel-wrapper">
        <div id="main-carousel" class="splide" aria-label="Main Carousel">
          <div class="splide__track">
            <ul class="splide__list">
              {% for image in product.images %}
                <li class="splide__slide">
                  {{ image | image_url: width: 500 | image_tag: alt: 'product image' }}
                </li>
              {% endfor %}
            </ul>
          </div>
          <!-- custom navigation arrows under main image -->
        </div>
        <div class="custom-thumbnail-arrows">
          <button disabled class="thumbnail-arrow-prev">{% render 'icon-arrow-prev' %}</button>
          <button class="thumbnail-arrow-next">{% render 'icon-arrow-next' %}</button>
        </div>
      </div>
    </div>
    <div class="product-info-card">
      <h1 class="product-title">{{ product.title }}</h1>
      <p class="product-description">{{ product.description | strip_html | strip_newlines }}</p>
      <p class="product-price-info">
        {% if product.compare_at_price > product.price %}
          <span class="product-price-compare">
            {{ product.compare_at_price | money }}
          </span>
        {% endif %}
        <span class="product-price">{{ product.price | money }}</span>
        <span class="product-tax-note">
          {{ 'products.product.taxes_included' | t }}
        </span>
      </p>
      {% if product.available %}
        <p class="product-availability available">
          {{ 'products.product.inventory_in_stock' | t }}, {{ 'products.product.normal_shipping_time' | t }}
        </p>
      {% else %}
        <p class="product-availability unavailable">
          {{ 'products.product.inventory_out_of_stock' | t }}
        </p>
      {% endif %}
      <form method="post" action="/cart/add">
        <input
          type="hidden"
          name="id"
          value="{{ product.variants.first.id }}">
        <button
          type="submit"
          {% if product.selected_or_first_available_variant.available == false or product.available == null
          %}
            disabled
          {% endif %}
          class="product-add-to-cart">
          {{ 'products.product.add_to_cart' | t }}
        </button>
      </form>
    </div>
  </div>
    
  <div class="usp-wrapper">
    {% for block in section.blocks %}
      {% if block.type == 'usp' %}
        <div class="usp-item">
          {% if block.settings.icon != blank %}
            <img
              src="{{ block.settings.icon | image_url: width: 64, height: 64 }}"
              alt="USP Icon"
              class="usp-icon"
              width="64"
              height="64"/>
          {% endif %}
          <div class="usp-content">
            <p class="usp-title">{{ block.settings.title }}</p>
            <p class="usp-subtitle">{{ block.settings.subtitle }}</p>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
          
</section>

{%- comment -%}
  Initialize synchronized Splide sliders:
  - #thumbnail-slider: shows clickable thumbnails
  - #main-slider: shows full-size product media
  - On desktop: vertical thumbs | On mobile: horizontal layout
{%- endcomment -%}

{%- comment -%} SplideJS Gallery Synchronisation {%- endcomment -%}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // MAIN CAROUSEL
    const main = new Splide('#main-carousel', {
      type       : 'loop',
      perPage    : 1,
      focus      : 'center',
      gap        : '.7rem',
      padding    : { left: 0, right: 0 }, 
      arrows     : false,
      pagination : false,
      heightRatio: 1,
      breakpoints: {
        768: {
          padding: { left: '5vw', right: '5vw' },
          pagination: true,
        },
      },
    });

    // THUMBNAIL CAROUSEL
    const thumbs = new Splide('#thumbnail-carousel', {
      direction     : 'ttb',
      height        : '445px',
      gap           : '15px',
      perPage       : 4,
      perMove       : 1,
      pagination    : false,
      arrows        : false,
      isNavigation  : true,
      breakpoints: {
        768: {
          direction: 'ltr',
          height   : null,
        }
      }
    });

    main.sync(thumbs);

    main.mount();
    thumbs.mount();

    document.querySelector('.thumbnail-arrow-prev')?.addEventListener('click', () => {
      thumbs.go('<');
    });

    document.querySelector('.thumbnail-arrow-next')?.addEventListener('click', () => {
      thumbs.go('>');
    });

    function updateArrowState(slider) {
      const prevBtn = document.querySelector('.thumbnail-arrow-prev');
      const nextBtn = document.querySelector('.thumbnail-arrow-next');

      if (!prevBtn || !nextBtn) return;

      prevBtn.disabled = slider.index === 0;
      nextBtn.disabled = slider.index >= slider.length - slider.options.perPage;
    }

    thumbs.on('mounted move', () => updateArrowState(thumbs));
  });
</script>


{% schema %}
{
  "name": "PDP BlickSolutions",
  "tag": "section",
  "class": "section-pdp",
  "settings": [],
  "blocks": [
    {
      "type": "usp",
      "name": "USP-Element",
      "settings": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Ãœberschrift"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Untertitel"
        }
      ]
    }
  ],
  "max_blocks": 3,
  "presets": [
    {
      "name": "PDP BlickSolutions",
      "blocks": [
        { "type": "usp" },
        { "type": "usp" },
        { "type": "usp" }
      ]
    }
  ]
}
{% endschema %}
